!function(e,o,t,r,n,i,l,s,a){"use strict";let{Permissions:u}=r.constants,{computePermissions:c}=t.findByProps("computePermissions","canEveryoneRole"),d=t.findByStoreName("GuildMemberStore"),f=[r.i18n.Messages.AI_TAG,r.i18n.Messages.BOT_TAG_SERVER,r.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,r.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,r.i18n.Messages.REMIXING_TAG,],p=[{text:"WEBHOOK",condition:function(e,o,t){return t.isNonUserBot()}},{text:"OWNER",backgroundColor:i.rawColors.ORANGE_345,condition:function(e,o,t){return e?.ownerId===t.id}},{text:r.i18n.Messages.BOT_TAG_BOT,condition:function(e,o,t){return t.bot},verified:function(e,o,t){return t.isVerifiedBot()}},{text:"ADMIN",backgroundColor:i.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:i.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS",]},{text:"MOD",backgroundColor:i.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS",]},{text:"MEMBER",backgroundColor:i.rawColors.GREY_500,condition(e,o,t){let r=c({user:t,context:e,overwrites:o?.permissionOverwrites});return(r&u.SEND_MESSAGES)===u.SEND_MESSAGES}},];function g(e,t,n){let l;if(e){let s=c({user:n,context:e,overwrites:t?.permissionOverwrites});l=Object.entries(u).map(function([e,o]){return s&o?e:""}).filter(Boolean)}for(let a of p)if(a.condition?.(e,t,n)||a.permissions?.some(function(e){return l?.includes(e)})){let f=o.storage.useRoleColor?d.getMember(e?.id,n.id)?.colorString:void 0,g=f||(a.backgroundColor??i.rawColors.BRAND_500),E=f||!a.textColor?70>r.chroma(g).get("lab.l")?i.rawColors.WHITE_500:i.rawColors.BLACK_500:a.textColor;return{...a,textColor:E,backgroundColor:g,verified:"function"==typeof a.verified?a.verified(e,t,n):a.verified??!1,condition:void 0,permissions:void 0}}}let E=t.findByName("getTagProperties",!1),C=t.findByStoreName("GuildStore"),m=t.findByStoreName("ChannelStore"),y=t.findByProps("getBotLabel"),S=y.getBotLabel,h=t.findByStoreName("GuildStore"),B=function([{guildId:e,user:o}],t){console.log(t);let r=l.findInReactTree(t.props.label,function(e){return e.type.Types});if(!r||!f.includes(S(r.props.type))){let n=h.getGuild(e),i=g(n,void 0,o);if(i){if(r)r.props={type:0,...i};else{let s=l.findInReactTree(t.props.label,function(e){return e.props?.lineClamp}).props.children;s.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(y.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}}},x=t.findByName("DisplayName",!1),N=t.findByName("HeaderName",!1),A=t.findByProps("getBotLabel"),M=A.getBotLabel,R=t.findByStoreName("GuildStore"),T=t.findByStoreName("ChannelStore"),G=t.findByProps("getBotLabel"),{ScrollView:b}=a.General,{FormSection:v,FormSwitchRow:$}=a.Forms,I=[];e.default={onLoad:function(){o.storage.useRoleColor??=!1,I.push(n.after("default",E,function([{message:e}],o){if(!f.includes(o.tagText)){let t=m.getChannel(e.channel_id),n=C.getGuild(t?.guild_id),i=g(n,t,e.author);if(i)return{...o,tagText:i.text,tagTextColor:i.textColor?r.ReactNative.processColor(r.chroma(i.textColor).hex()):void 0,tagBackgroundColor:i.backgroundColor?r.ReactNative.processColor(r.chroma(i.backgroundColor).hex()):void 0,tagVerified:i.verified,tagType:void 0}}})),I.push(n.after("default",G,function([{text:e,textColor:o,backgroundColor:t}],r){let n=l.findInReactTree(r,function(e){return"string"==typeof e.props.children});e&&(n.props.children=e),o&&n.props.style.push({color:o}),t&&r.props.style.push({backgroundColor:t})})),I.push(function e(){let o=[];return o.push(n.after("default",N,function([{channelId:e}],o){o.props.channelId=e})),o.push(n.after("default",x,function([{guildId:e,channelId:o,user:t}],r){let n=l.findInReactTree(r,function(e){return e.type.Types});if(!n||!f.includes(M(n.props.type))){let i=R.getGuild(e),s=T.getChannel(o),a=g(i,s,t);a&&(n?n.props={type:0,...a}:l.findInReactTree(r,function(e){return"row"===e.props.style.flexDirection}).props.children.push(React.createElement(A.default,{style:{marginLeft:0},type:0,text:a.text,textColor:a.textColor,backgroundColor:a.backgroundColor,verified:a.verified})))}})),function(){return o.forEach(function(e){return e()})}}()),I.push(function e(){let o=[];return t.findByTypeNameAll("UserRow").forEach(function(e){return o.push(n.after("type",e,B))}),function(){return o.forEach(function(e){return e()})}}())},onUnload:function(){return I.forEach(function(e){return e()})},settings:function e(){return s.useProxy(o.storage),React.createElement(b,{style:{flex:1}},React.createElement(v,{title:"Tag style"},React.createElement($,{label:"Use top role color for tag backgrounds",value:o.storage.useRoleColor,onValueChange:function(e){o.storage.useRoleColor=e}})))}},Object.defineProperty(e,"__esModule",{value:!0})}({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);

!function(e,o,t,r,n,i,s,a,l){"use strict";const{Permissions:c}=r.constants,{computePermissions:u}=t.findByProps("computePermissions","canEveryoneRole"),d=t.findByStoreName("GuildMemberStore"),f=[r.i18n.Messages.AI_TAG,r.i18n.Messages.BOT_TAG_SERVER,r.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,r.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,r.i18n.Messages.REMIXING_TAG],p=[{text:"WEBHOOK",condition:function(e,o,t){return t.isNonUserBot()}},{text:"OWNER",backgroundColor:i.rawColors.ORANGE_345,condition:function(e,o,t){return e?.ownerId===t.id}},{text:r.i18n.Messages.BOT_TAG_BOT,condition:function(e,o,t){return t.bot},verified:function(e,o,t){return t.isVerifiedBot()}},{text:"ADMIN",backgroundColor:i.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MEMBER",backgroundColor:i.rawColors.RED_560,permissions:["VIEW_CHANNEL ","SEND_MESSAGES","READ_MESSAGE_HISTORY"]},{text:"MANAGER",backgroundColor:i.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:i.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function g(e,t,n){let s;if(e){const o=u({user:n,context:e,overwrites:t?.permissionOverwrites});s=Object.entries(c).map((function([e,t]){return o&t?e:""})).filter(Boolean)}for(const a of p)if(a.condition?.(e,t,n)||a.permissions?.some((function(e){return s?.includes(e)}))){let s=o.storage.useRoleColor?d.getMember(e?.id,n.id)?.colorString:void 0,l=s||(a.backgroundColor??i.rawColors.BRAND_500),c=s||!a.textColor?r.chroma(l).get("lab.l")<70?i.rawColors.WHITE_500:i.rawColors.BLACK_500:a.textColor;return{...a,textColor:c,backgroundColor:l,verified:"function"==typeof a.verified?a.verified(e,t,n):a.verified??!1,condition:void 0,permissions:void 0}}}const E=t.findByName("getTagProperties",!1),C=t.findByStoreName("GuildStore"),m=t.findByStoreName("ChannelStore");const R=t.findByProps("getBotLabel"),y=R.getBotLabel,S=t.findByStoreName("GuildStore"),h=function([{guildId:e,user:o}],t){console.log(t);const r=s.findInReactTree(t.props.label,(function(e){return e.type.Types}));if(!r||!f.includes(y(r.props.type))){const n=g(S.getGuild(e),void 0,o);if(n)if(r)r.props={type:0,...n};else{s.findInReactTree(t.props.label,(function(e){return e.props?.lineClamp})).props.children.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(R.default,{type:0,text:n.text,textColor:n.textColor,backgroundColor:n.backgroundColor,verified:n.verified}))}}};const B=t.findByName("DisplayName",!1),_=t.findByName("HeaderName",!1),A=t.findByProps("getBotLabel"),N=A.getBotLabel,v=t.findByStoreName("GuildStore"),x=t.findByStoreName("ChannelStore");const M=t.findByProps("getBotLabel");const{ScrollView:T}=l.General,{FormSection:b,FormSwitchRow:G}=l.Forms;let I=[];var O={onLoad:function(){o.storage.useRoleColor??=!1,I.push(n.after("default",E,(function([{message:e}],o){if(!f.includes(o.tagText)){const t=m.getChannel(e.channel_id),n=g(C.getGuild(t?.guild_id),t,e.author);if(n)return{...o,tagText:n.text,tagTextColor:n.textColor?r.ReactNative.processColor(r.chroma(n.textColor).hex()):void 0,tagBackgroundColor:n.backgroundColor?r.ReactNative.processColor(r.chroma(n.backgroundColor).hex()):void 0,tagVerified:n.verified,tagType:void 0}}}))),I.push(n.after("default",M,(function([{text:e,textColor:o,backgroundColor:t}],r){const n=s.findInReactTree(r,(function(e){return"string"==typeof e.props.children}));e&&(n.props.children=e),o&&n.props.style.push({color:o}),t&&r.props.style.push({backgroundColor:t})}))),I.push(function(){const e=[];return e.push(n.after("default",_,(function([{channelId:e}],o){o.props.channelId=e}))),e.push(n.after("default",B,(function([{guildId:e,channelId:o,user:t}],r){const n=s.findInReactTree(r,(function(e){return e.type.Types}));if(!n||!f.includes(N(n.props.type))){const i=g(v.getGuild(e),x.getChannel(o),t);i&&(n?n.props={type:0,...i}:s.findInReactTree(r,(function(e){return"row"===e.props.style.flexDirection})).props.children.push(React.createElement(A.default,{style:{marginLeft:0},type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified})))}}))),function(){return e.forEach((function(e){return e()}))}}()),I.push(function(){const e=[];return t.findByTypeNameAll("UserRow").forEach((function(o){return e.push(n.after("type",o,h))})),function(){return e.forEach((function(e){return e()}))}}())},onUnload:function(){return I.forEach((function(e){return e()}))},settings:function(){return a.useProxy(o.storage),React.createElement(T,{style:{flex:1}},React.createElement(b,{title:"Tag style"},React.createElement(G,{label:"Use top role color for tag backgrounds",value:o.storage.useRoleColor,onValueChange:function(e){o.storage.useRoleColor=e}})))}};e.default=O,Object.defineProperty(e,"__esModule",{value:!0})}({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
